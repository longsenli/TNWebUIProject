<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<script type="text/javascript" src="../../../vendor/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="../../../vendor/jquery/jquery.cookie.js"></script>
	<script type="text/javascript" src="../../../vendor/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="../../../vendor/boostrap-select/bootstrap-select.min.js"></script>
	<script type="text/javascript" src="../../../vendor/bootstrap-datatable/bootstrap-table.js"></script>
	<script type="text/javascript" src="../../../js/common.js"></script>
	<script type="text/javascript" src="../../../vendor/bootstrap-datatable/bootstrap-table-zh-CN.js"></script>
	<script type="text/javascript" src="../../../vendor/ry/ajax/libs/iCheck/icheck.min.js" ></script>
	<script type="text/javascript" src="../../../vendor/ry/ajax/libs/select/select2.js" ></script>
	<link rel="stylesheet" type="text/css" href="../../../vendor/bootstrap/css/bootstrap.min.css" media="screen">
	<link rel="stylesheet" type="text/css" href="../../../vendor/bootstrap/css/bootstrap-switch.css" media="screen">
	<link rel="stylesheet" type="text/css" href="../../../vendor/boostrap-select/bootstrap-select.min.css" media="screen">
	<link rel="stylesheet" type="text/css" href="../../../vendor/bootstrap-datatable/bootstrap-table.css" media="screen">
	<link type="text/css" media="screen" href="../../../vendor/ry/ajax/libs/iCheck/custom.css"  rel="stylesheet"/>
</head>
	<body>
		<section class="content table-content">
			<form class="form-inline" >
			<!-- 工具栏 -->
			<div id="toolbar">
					<input type="button" value="新增角色" id="addBtn" data-toggle="modal" data-target="#addRoleModal" class="btn btn-primary"></input>
					<input type="button" value="修改角色" id="editBtn" data-toggle="modal" data-target="#editRoleModal" class="btn btn-primary" onclick="editRole()"></input>
					<input type="button" value="删除角色" id="deleteBtn" data-toggle="modal" data-target="#deleteRoleModal" class="btn btn-primary" onclick="deleteRole()"></input>
			</div>

			<!-- bootstrapTable -->
			</form>
			<table id="dataGrid">
			</table>
		</section>
		<!-- 新增用户的模态框，在修改用户中将获取一行的值放入input中，改变一些参数继续使用 -->
		<div class="modal fade" id="addRoleModal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h3>新增角色</h3>
					</div>
					<div class="modal-body">
						<form id="addRoleForm" action="" method="post" class="form-horizontal">
							<div class="form-group">
								<label for="inputRoleName" class="col-sm-2 control-label">角色名</label>
								<div class="col-sm-7">
									<input type="text" name="roleName" class="form-control" id="inputRoleName" placeholder="角色名"/>
								</div>
								<label id="errorRoleName" for="inputRoleName" class="col-sm-3 control-label"></label>
							</div>
							<div class="form-group">
								<label for="inputRemark" class="col-sm-2 control-label">备注</label>
								<div class="col-sm-7">
									<input type="text" name="remark" class="col-sm-4 form-control" id="inputRemark" placeholder="备注"/>
								</div>
								<label id="errorRemark" for="inputRemark" class="col-sm-3 control-label"></label>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" id="conf" class="btn btn-default" onclick="addRole()">确定</button>
						<button type="button" class="btn btn-default" data-dismiss="modal" onclick="resetAddModal()">取消</button>
					</div>
				</div>				
			</div>
		</div>
<!-- 修改用户的模态框 -->
		<div class="modal fade" id="editModal" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h3>修改角色</h3>
					</div>
					<div class="modal-body">
						<form id="editForm" method="post" class="form-horizontal">
							<div class="form-group" style="display:none">
								<label for="editRoleId" class="col-sm-2 control-label">roleID</label>
								<div class="col-sm-7">
									<input type="text" name="roleId"   class="form-control" id="editRoleId" placeholder="ID" />
								</div>
								<label id="errorId" for="editRoleId" class="col-sm-3 control-label"></label>
							</div>
							<div class="form-group">
								<label for="editRoleName" class="col-sm-2 control-label">角色名</label>
								<div class="col-sm-7">
									<input type="text" name="roleName" class="form-control" id="editRoleName" placeholder="登录名"/>
								</div>
								<label id="errorAccount" for="editRoleName" class="col-sm-3 control-label"></label>
							</div>
							<div class="form-group">
								<label for="editStatus" class="col-sm-2 control-label">状态</label>
								<div class="col-sm-7">
									<input type="text" name="status" class="col-sm-4 form-control" id="editStatus" placeholder="状态"/>
								</div>
								<label id="errorRemark" for="editStatus" class="col-sm-3 control-label"></label>
							</div>
							<div class="form-group">
								<label for="editRemark" class="col-sm-2 control-label">备注</label>
								<div class="col-sm-7">
									<input type="text" name="remark" class="col-sm-4 form-control" id="editRemark" placeholder="备注"/>
								</div>
								<label id="errorRemark" for="editRemark" class="col-sm-3 control-label"></label>
							</div>
							<div class="form-group" style="display:none">
								<label for="inputCreated_at" class="col-sm-2 control-label">创建时间</label>
								<div class="col-sm-7">
									<input type="created_at" name="created_at" class="col-sm-4 form-control" id="editCreated_at" placeholder="创建时间" />
								</div>
								<label id="errorCreated_at" for="inputCreated_at" class="col-sm-3 control-label"></label>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" id="conf" class="btn btn-default" onclick="updateRole()">确定</button>
						<button type="button" class="btn btn-default" data-dismiss="modal" onclick="resetAddModal()">取消</button>
					</div>
				</div>				
			</div>
		</div>
		<div class="modal fade" id="Tip" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h3>提示</h3>
					</div>
					<div class="modal-body" align="center">
						<h4 id="tipContent">新增成功</h4>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">确定</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="updateEnd" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h3>提示</h3>
					</div>
					<div class="modal-body" align="center">
						<h4 id="al">修改成功</h4>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">确定</button>
					</div>
				</div>
			</div>
		</div>
</body>
</html>


<script type="text/javascript">
			initDataGrid();
		function initDataGrid(){
			var columnsArray = [];
			columnsArray.push({
				checkbox: true
			});
			columnsArray.push({
				"title": "roleId",
				"field": "roleId",
				 "visible":false
			});
			columnsArray.push({
				"title": "角色名",
				"field": "roleName"
			});
			columnsArray.push({
				"title": "状态",
				"field": "status",
				align: 'center',
				formatter: function(value, row, index) {
					if (value == '1') {
						return '<span class="badge badge-primary">正常</span>';
					} else if (value == '0') {
						return '<span class="badge badge-danger">停用</span>';
					}
				}
			});
			columnsArray.push({
				"title": "备注",
				"field": "remark"
			});
			
			$.ajax({
				url: window.serviceIP + "/role/listRoles",
				type: "POST",
				contentType: "application/json",
				dataType: "json",
				//		headers: {
				//			Token: $.cookie('token')
				//		},
				processData: true,
				success: function(dataRes) {
					if(dataRes.status == 1) { 
						var models = eval("(" + dataRes.data + ")");
						 console.log(models);
						$('#dataGrid').bootstrapTable('destroy').bootstrapTable({
							data: models,
							toolbar: '#toolbar',
							singleSelect: true,
							clickToSelect: true,
							sortName: "recordTime",
							sortOrder: "desc",
							pageSize: 15,
							pageNumber: 1,
							pageList: "[10, 25, 50, 100, All]",
							showToggle: true,
							showRefresh: true,
							showColumns: true,
							search: true,
							pagination: true,
							columns: columnsArray
						});
					} else {
						alert("初始化数据失败！" + dataRes.message);
					}
				}
			});
		}
		
		
		
		
			function queryParam(params){
		    	var param = {
		    			limit : this.limit, // 页面大小
		    	        offset : this.offset, // 页码
		    	        pageNumber : this.pageNumber,
		    	        pageSize : this.pageSize
		    	};
		    	return param;
		    }
			//点击取消后清空表单中已写信息
			function resetAddModal(){
				document.getElementById("addRoleForm").reset();
			}
			//新增用户
			function addRole(){
				var param = $("#addRoleForm").serializeArray();
				debugger;
				$("#conf").attr("onclick","addRole()");
				$.ajax({
					// url:"http://localhost:80/Role/addRole",
					url: window.serviceIP + "/role/addRole",
					method:"post",
					data:param,
					dataType:"json",
					success:function(data){
						// alert("新增成功");
						if(data.status=="1"){
							 // document.getElementById("al").innerText="保存成功";
							alert("保存成功");
							
							document.getElementById("addRoleForm").reset();
							// console.log(data);
							// $("#Tip").modal('show');
							$("#addRoleModal").modal('hide');
							initDataGrid();
							// $("#dataGrid").bootstrapTable('refresh');
						}
						else{
							 alert("保存失败!");
						}
					},
					error:function(){
						document.getElementById("al").innerText="新增失败";
						$("#addEnd").modal('show');
					}
				});
			}
			//修改角色
			function editRole(){
				//获取选中行的数据
				var rows = $("#dataGrid").bootstrapTable('getSelections');
				if(rows.length!=1){
					document.getElementById("tipContent").innerText="请选择一行数据";
					$("#Tip").modal('show');
				}
				else{
				var row = rows[0];
				$('#editRoleId').val(row.roleId);
				$('#editRoleName').val(row.roleName);
				$('#editRemark').val(row.remark);
				$('#editStatus').val(row.status);
				$('#editCreated_at').val(row.created_at);
				$("#editModal").modal("show");
				}
			}
			function updateRole(){
				var param = $("#editForm").serializeArray();
				alert(param);
				//设为disable则无法获取
				$.ajax({
					url:window.serviceIP + "/role/updateRole",
					method:"post",
					data:param,
					dataType:"json",
					success:function(data){
						if(data.status=="1"){
							$("#editModal").modal("hide");
							document.getElementById("tipContent").innerText="修改成功";
							$("#Tip").modal('show');
							initDataGrid();
						}
					},
					error:function(data){
						alert("wrong");
					}
				});
			}
		/**
		 * 
		 */
		function deleteRole(){
				var rows = $("#dataGrid").bootstrapTable("getSelections");
				var ids = [];
				var len = rows.length;
				debugger;
				for(var i=0;i<len;i++){
					ids.push(rows[i].roleId);
				}
				debugger;
				$.ajax({
					url:window.serviceIP + "/role/deleteRole",
					dataType:"json",
					traditional: true,//属性在这里设置
					method:"post",
					data:{
						"ids":ids
					},
					success:function(data){
						// alert(data.state);
						if(data.status == '1'){
							alert('删除成功');
							initDataGrid();
						}
// 						document.getElementById("tipContent").innerText="删除成功";
// 						$("#Tip").modal('show');
						
						// $("#dataGrid").bootstrapTable("refresh");
					},
					error:function(){
						document.getElementById("tipContent").innerText="删除失败";
						$("#Tip").modal('show');
					}
				});
			}
		

</script>