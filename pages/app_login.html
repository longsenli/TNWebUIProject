<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="user-scalable=0">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>天能（濮阳）</title>

		<!-- CSS -->
		<!-- <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:400,100,300,500"> -->
		<link rel="stylesheet" href="../vendor/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="../vendor/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="../vendor/login/css/form-elements.css">
		<link rel="stylesheet" href="../vendor/login/css/style.css">

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

		<!-- Favicon and touch icons -->
		<!-- <link rel="shortcut icon" href="../vendor/login/ico/favicon.png"> -->
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../vendor/login/ico/apple-touch-icon-144-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../vendor/login/ico/apple-touch-icon-114-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../vendor/login/ico/apple-touch-icon-72-precomposed.png">
		<!-- <link rel="apple-touch-icon-precomposed" href="../vendor/login/ico/apple-touch-icon-57-precomposed.png"> -->

		<!-- Javascript -->
		<!--<script src="../vendor/jquery/jquery.min.js"></script>-->
		<script src="../vendor/jquery/jquery.min.js"></script>
		<script src="../vendor/jquery/jquery.cookie.js"></script>

		<script src="../vendor/login/js/jquery.backstretch.min.js"></script>
		<script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

		<script src="../vendor/login/js/scripts.js"></script>
		<script src="../js/common.js"></script>
		<!--Nifty Stylesheet [ REQUIRED ]-->
		<link href="../vendor/nifty_admin_v2.9/demo/css/nifty.css" rel="stylesheet">
	</head>

	<body onload="appLoginPageload();">

		<!-- Top content -->
		<div class="top-content">
			<div class="container">
				<div class="row">
					<div class="col-sm-8 col-sm-offset-2 text">
						<h3><font color="#FFFFFF">智能制造精益生产系统</font></h3>
						<!-- <p>
								为了让我们的生产流程信息化、智能化而不断努力！
							</p> -->
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6 col-sm-offset-3 form-box">
						<div class="form-top">
							<div class="form-top-left">
								<h3>系统登录</h3>
								<p id="hintinfo">请输入您的用户名和密码：</p>
							</div>
							<div class="form-top-right">
								<i class="fa fa-key"></i>
							</div>
						</div>
						<div class="form-bottom">
							<form action="" method="post" class="login-form" onsubmit="return login()">
								<div class="form-group">
									<!--    		<label class="sr-only" for="form-username">Username</label>-->
									<input type="text" name="form-username" placeholder="用户名" class="form-username form-control" id="form-username" required>
								</div>
								<div class="form-group">
									<!--<label class="sr-only" for="form-password">Password</label>-->
									<input type="password" name="form-password" placeholder="密码" class="form-password form-control" id="form-password" required>
								</div>
								<!--    <a href="index.html" class="btn btn-lg btn-success btn-block">登录</a>-->
								<button type="submit" class="btn">登录</button>
							</form>
							<div align="right" style="padding-top: 10px;">
								<a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
									<i style="font-size: x-large;color: #3C763D" class="fa fa-cog"></i>
									<span style="font-size: x-large;color: #3C763D">设置</span></a>
							</div>
							<div id="collapseTwo" class="panel-collapse collapse">
								<!-- <div class="form-group pad-ver">
								    <label class="col-md-3 control-label">按连接WIFI选择服务器信息</label>
								    <div class="col-md-9">
								        <div class="radio">
								            <input id="demo-inline-form-radio" class="magic-radio" type="radio" name="inline-form-radio" checked onclick="setRemoteServiceIP('10.0.0.151:19001')">
								            <label for="demo-inline-form-radio">MES网</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
										    <input id="demo-inline-form-radio-2" class="magic-radio" type="radio" name="inline-form-radio" onclick="setRemoteServiceIP('192.168.80.228:19001')">
										    <label for="demo-inline-form-radio-2">非MES网</label>
										</div>
										<span>说明: 登录前请连接公司内部WIFI, 默认为连接的MES网络, 其他网络请选择非MES网</span>
								    </div>
								</div> -->
								<!-- <input type="text" onblur="setRemoteServiceIP()" name="RemoteServiceIP" placeholder="设置服务器信息" class="form-username form-control" id="RemoteServiceIP" required> -->
								<label id="loginPage_show_RemoteServiceIP"></label>
								<label id="versionInfo">当前版本号:&nbsp;&nbsp;</label>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!--[if lt IE 10]>
            <script src="assets/js/placeholder.js"></script>
        <![endif]-->
		<script type="text/javascript">
			$(function() {
				document.addEventListener('plusready', function() {
					// 在这里调用5+ API 
					if(window.plus)
						versionCompare();
				}, false);
			});

			// 			function setRemoteServiceIP(ip) {
			// 				alert(ip)
			// 				var RemoteServiceIP = ip;
			// 				localStorage.setItem('RemoteServiceIP', RemoteServiceIP);
			// 				alert(localStorage.getItem('RemoteServiceIP', RemoteServiceIP));
			// 			}

			function appLoginPageload() {
				$("#form-username").val(localStorage.getItem('LocalUserName'));
				$("#form-password").val(localStorage.getItem('LocalUserPsw'));
				$("#loginPage_show_RemoteServiceIP").text('当前服务器地址: ' + localStorage.getItem('RemoteServiceIP'));
				// setRemoteServiceIP('10.0.0.151:19001');

			}

			function versionCompare() {
				var RemoteServiceIP1 = localStorage.getItem('RemoteServiceIP');
				if(RemoteServiceIP1 != null && RemoteServiceIP1 != 'undefined' && RemoteServiceIP1 != "") {
					window.webUiService = 'http://' + RemoteServiceIP1;
				}
				var versionNow;
				plus.runtime.getProperty(plus.runtime.appid, function(inf) {
					versionNow = inf.version;
				});
				document.getElementById('versionInfo').innerText = "当前版本号: " + localStorage.getItem("versionNow");
				$.ajax({
					type: "get",
					url: window.serviceIP + '/api/getappversionbyclienttype?clientType=apk',
					async: true,
					success: function(res) {
						localStorage.setItem("versionNow", versionNow);
						document.getElementById('versionInfo').innerText = "当前版本号: " + localStorage.getItem("versionNow");
						//alert(res.message)
						if(res.message > versionNow) //比对版本号
						{

							//console.log(new_version+'新版本'+version);
							plus.nativeUI.confirm("应用有新版本，是否立即下载更新？", function(event) {
								if(event.index == 1) {
									plus.nativeUI.showWaiting();
									//updateAppRun(window.webUiService + '/pages/H5EE481DB_0308142119.apk');
									//									alert(window.webUiService + '/tnpyILPS_' + res.message.toString().trim() + '.apk')
									updateAppRun(window.webUiService + '/tnpyILPS_' + res.message.toString().trim() + '.apk');

									//updateAppRun("http://fast.yingyonghui.com/82576ac98a5bf68aa822332c681ce0d9/5c84684a/apk/6363734/4e788c5e4446c6edece446bc92eef0af");
									//ks.update_ksd(new_json.url); //更新函数,在下面

								}
							}, '更新确认', ['取消', '确认']);
						}
					}
				});

			}
			//ks.update_ksd==========
			function updateAppRun(url) {
				//console.log(url);
				//创建下载管理对象
				var dtask = plus.downloader.createDownload(url, {}, function(d, status) {
					// 下载完成
					if(status == 200) { //下载成功后的回调函数
						//alert("下载成功，准备安装" + d.filename)
						plus.nativeUI.toast("下载成功，准备安装" + d.filename);
						//console.log(d);
						//安装程序，第一个参数是路径，默认的下载路径在_downloads里面
						//plus.runtime.install('_downloads/ksd.apk', {}, function() {
						plus.runtime.install(d.filename, {}, function() {
							plus.nativeUI.toast('安装成功');
						}, function() {
							plus.nativeUI.toast('安装失败');
						});
						plus.nativeUI.closeWaiting();
					} else {
						alert("下载失败 " + status);
						plus.nativeUI.closeWaiting();
					}
				});
				//dtask.addEventListener( "statechanged", onStateChanged, false );
				dtask.start(); //开始下载任务
			}

			function login() {
				var defaultIP = "10.0.0.151:19001";
				if(localStorage.getItem('myDefaultIP')) {
					defaultIP = localStorage.getItem('myDefaultIP');
				}
				var unselectedMenu = localStorage.getItem('unselectedMenu');
				var username = document.getElementById("form-username").value;
				var password = document.getElementById("form-password").value;
				// var RemoteServiceIP1 = localStorage.getItem('RemoteServiceIP');

				// 				if(RemoteServiceIP1 != null && RemoteServiceIP1 != 'undefined' && RemoteServiceIP1 != "") {
				// 					window.serviceIP = 'http://' + RemoteServiceIP1 + '/ilpsService';
				// 				}
				// 				alert('RemoteServiceIP1' + RemoteServiceIP1)
				// 				alert('window.serviceIP' + window.serviceIP)
				$.ajax({
					type: 'POST',
					// url:'http://192.168.1.100:8080/api/login',
					//url: 'http://10.0.0.151:19001/ilpsService/api/login',
					url: 'http://' + defaultIP.trim() + '/ilpsService/api/login',
					dataType: "json",
					data: {
						'username': username,
						"password": password
					},
					async: true, //设置为false时,timeout不生效
					timeout: 5000,
					success: function(result) {
						if(result.status == "1") {
							localStorage.clear();
							localStorage.setItem('RemoteServiceIP', defaultIP.trim());
							localStorage.setItem('unselectedMenu', unselectedMenu);
							localStorage.setItem('myDefaultIP', defaultIP.trim());
							// console.log(result)
							// var login_info = null;
							// 							login_info = login_info || {};
							// 							login_info.token = result.token || '';
							// 							login_info.username = result.message.split("###")[0].trim() || '';
							// 							login_info.userID = username || '';
							// 							login_info.roleID = result.message.split("###")[1].trim() || '';
							// 							login_info.password = password || '';
							//登陆成功后获取token
							var token = JSON.parse(result.token);
							token.username = result.message.split("###")[0].trim() || '';
							token.userID = username || '';
							token.roleID = result.message.split("###")[1].trim() || '';
							token.password = password || '';

							// 							login_info = {
							// 								'token':result.token,
							// 								'username':result.message.split("###")[0].trim(),
							// 								'userID':username,
							// 								'roleID':result.message.split("###")[1].trim(),
							// 								'password': password
							// 							};
							// localStorage.setItem('Global_UserLogin_Info',Global_UserLogin_Info);
							// alert(localStorage.getItem('$users'))

							// 							$.cookie('username', result.message.split("###")[0].trim());
							// 							$.cookie('userID', username);
							// 							$.cookie('roleID', result.message.split("###")[1].trim());
							// 							$.cookie('password', password);

							if(result.message.split("###")[2].trim() != "-1" && result.message.split("###")[2].trim() != "null" && result.message.split("###")[2].trim().length > 1) {
								// $.cookie('plantID', result.message.split("###")[2].trim());
								token.plantID = result.message.split("###")[2].trim();

								localStorage.setItem('plantID', result.message.split("###")[2].trim());
							}
							if(result.message.split("###")[3].trim() != "-1" && result.message.split("###")[3].trim() != "null" && result.message.split("###")[3].trim().length > 1) {
								// $.cookie('processID', result.message.split("###")[3].trim());
								token.processID = result.message.split("###")[3].trim();

								localStorage.setItem('processID', result.message.split("###")[3].trim());
							}
							if(result.message.split("###")[4].trim() != "-1" && result.message.split("###")[4].trim() != "null" && result.message.split("###")[4].trim().length > 1) {
								// $.cookie('lineID', result.message.split("###")[4].trim());
								token.lineID = result.message.split("###")[4].trim();

								localStorage.setItem('lineID', result.message.split("###")[4].trim());
							}
							if(result.message.split("###")[5].trim() != "-1" && result.message.split("###")[5].trim() != "null" && result.message.split("###")[5].trim().length > 1) {
								token.workingkLocation = result.message.split("###")[5].trim();

								localStorage.setItem('workingkLocation', result.message.split("###")[5].trim());
							}
							// alert(JSON.stringify(token));
							// 							var Global_UserLogin_Info = [];
							// 							Global_UserLogin_Info.push(login_info);
							//将全局token等信息放入变量$Global_UserLogin_Info
							localStorage.setItem('$Global_UserLogin_Info', JSON.stringify(token));
							localStorage.setItem("LocalUserName", username);
							localStorage.setItem("LocalUserPsw", password);

							localStorage.setItem('token', result.token);
							localStorage.setItem('username', result.message.split("###")[0].trim());
							localStorage.setItem('userID', username);
							localStorage.setItem('roleID', result.message.split("###")[1].trim());
							localStorage.setItem('password', password);

							// 							var aa = localStorage.getItem('$Global_UserLogin_Info');
							// 							alert(aa.token)
							// 							var users = JSON.parse(localStorage.getItem('$Global_UserLogin_Info'));
							// 							alert(users.token)
							//							if('iOS' == window.plus.os.name) {
							//								// alert('IOS')
							//								window.location.href = "app_productionIndex_ios.html";
							//								return;
							//							}
							if(result.message.split("###")[1].trim() == "24") {
								window.location.href = "app_productionIndex.html";
							} else {
								window.location.href = "app_productionIndex.html";
							}

						} else {
							var hintinfo = document.getElementById("hintinfo");
							hintinfo.innerHTML = '<font color="red">用户名或密码错误，请重新填写。</font>';
							//							hintinfo.innerText = "用户名或密码错误，请重新填写。";
						}
					},

					error: function(XMLHttpRequest, status, err) {
						//						alert('出现错误,请联系管理员!')
					},
					complete: function(XMLHttpRequest, status) { //当请求完成时调用函数
						// alert(XMLHttpRequest.status + status)
						if(status == 'timeout') { //status == 'timeout'意为超时,status的可能取值：success,notmodified,nocontent,error,timeout,abort,parsererror 
							// alert(status + "，连接服务器失败，请检查配置信息及网络连接！")
							//							alert(status + "，连接MES网络服务器失败，正在尝试登录mes网服务器！")
							mes_login();
						}
					}

				});
				return false;
			}

			//默认10.0.0.151登录调用方法
			function mes_login() {

				var unselectedMenu = localStorage.getItem('unselectedMenu');
				var username = document.getElementById("form-username").value;
				var password = document.getElementById("form-password").value;
				// var RemoteServiceIP1 = localStorage.getItem('RemoteServiceIP');

				// 				if(RemoteServiceIP1 != null && RemoteServiceIP1 != 'undefined' && RemoteServiceIP1 != "") {
				// 					window.serviceIP = 'http://' + RemoteServiceIP1 + '/ilpsService';
				// 				}
				// 				alert('RemoteServiceIP1' + RemoteServiceIP1)
				// 				alert('window.serviceIP' + window.serviceIP)
				$.ajax({
					type: 'POST',
					// url:'http://192.168.1.100:8080/api/login',
					//url: 'http://10.0.0.151:19001/ilpsService/api/login',
					url: 'http://10.0.0.151:19001/ilpsService/api/login',
					dataType: "json",
					data: {
						'username': username,
						"password": password
					},
					async: true, //设置为false时,timeout不生效
					timeout: 5000,
					success: function(result) {
						if(result.status == "1") {
							localStorage.clear();
							localStorage.setItem('RemoteServiceIP', '10.0.0.151:19001');
							localStorage.setItem('unselectedMenu', unselectedMenu);
							localStorage.setItem('myDefaultIP', '10.0.0.151:19001');
							// console.log(result)
							// var login_info = null;
							// 							login_info = login_info || {};
							// 							login_info.token = result.token || '';
							// 							login_info.username = result.message.split("###")[0].trim() || '';
							// 							login_info.userID = username || '';
							// 							login_info.roleID = result.message.split("###")[1].trim() || '';
							// 							login_info.password = password || '';
							//登陆成功后获取token
							var token = JSON.parse(result.token);
							token.username = result.message.split("###")[0].trim() || '';
							token.userID = username || '';
							token.roleID = result.message.split("###")[1].trim() || '';
							token.password = password || '';

							// 							login_info = {
							// 								'token':result.token,
							// 								'username':result.message.split("###")[0].trim(),
							// 								'userID':username,
							// 								'roleID':result.message.split("###")[1].trim(),
							// 								'password': password
							// 							};
							// localStorage.setItem('Global_UserLogin_Info',Global_UserLogin_Info);
							// alert(localStorage.getItem('$users'))

							// 							$.cookie('username', result.message.split("###")[0].trim());
							// 							$.cookie('userID', username);
							// 							$.cookie('roleID', result.message.split("###")[1].trim());
							// 							$.cookie('password', password);

							if(result.message.split("###")[2].trim() != "-1" && result.message.split("###")[2].trim() != "null" && result.message.split("###")[2].trim().length > 1) {
								// $.cookie('plantID', result.message.split("###")[2].trim());
								token.plantID = result.message.split("###")[2].trim();

								localStorage.setItem('plantID', result.message.split("###")[2].trim());
							}
							if(result.message.split("###")[3].trim() != "-1" && result.message.split("###")[3].trim() != "null" && result.message.split("###")[3].trim().length > 1) {
								// $.cookie('processID', result.message.split("###")[3].trim());
								token.processID = result.message.split("###")[3].trim();

								localStorage.setItem('processID', result.message.split("###")[3].trim());
							}
							if(result.message.split("###")[4].trim() != "-1" && result.message.split("###")[4].trim() != "null" && result.message.split("###")[4].trim().length > 1) {
								// $.cookie('lineID', result.message.split("###")[4].trim());
								token.lineID = result.message.split("###")[4].trim();

								localStorage.setItem('lineID', result.message.split("###")[4].trim());
							}
							if(result.message.split("###")[5].trim() != "-1" && result.message.split("###")[5].trim() != "null" && result.message.split("###")[5].trim().length > 1) {
								token.workingkLocation = result.message.split("###")[5].trim();

								localStorage.setItem('workingkLocation', result.message.split("###")[5].trim());
							}
							// alert(JSON.stringify(token));
							// 							var Global_UserLogin_Info = [];
							// 							Global_UserLogin_Info.push(login_info);
							//将全局token等信息放入变量$Global_UserLogin_Info
							localStorage.setItem('$Global_UserLogin_Info', JSON.stringify(token));
							localStorage.setItem("LocalUserName", username);
							localStorage.setItem("LocalUserPsw", password);

							localStorage.setItem('token', result.token);
							localStorage.setItem('username', result.message.split("###")[0].trim());
							localStorage.setItem('userID', username);
							localStorage.setItem('roleID', result.message.split("###")[1].trim());
							localStorage.setItem('password', password);

							// 							var aa = localStorage.getItem('$Global_UserLogin_Info');
							// 							alert(aa.token)
							// 							var users = JSON.parse(localStorage.getItem('$Global_UserLogin_Info'));
							// 							alert(users.token)
							//							if('iOS' == window.plus.os.name) {
							//								// alert('IOS')
							//								window.location.href = "app_productionIndex_ios.html";
							//								return;
							//							}
							if(result.message.split("###")[1].trim() == "24") {
								window.location.href = "app_productionIndex.html";
							} else {
								window.location.href = "app_productionIndex.html";
							}

						} else {
							var hintinfo = document.getElementById("hintinfo");
							hintinfo.innerHTML = '<font color="red">用户名或密码错误，请重新填写。</font>';
							//							hintinfo.innerText = "用户名或密码错误，请重新填写。";
						}
					},

					error: function(XMLHttpRequest, status, err) {
						//						alert('出现错误,请联系管理员!')
					},
					complete: function(XMLHttpRequest, status) { //当请求完成时调用函数
						// alert(XMLHttpRequest.status + status)
						if(status == 'timeout') { //status == 'timeout'意为超时,status的可能取值：success,notmodified,nocontent,error,timeout,abort,parsererror 
							// alert(status + "，连接服务器失败，请检查配置信息及网络连接！")
							//							alert(status + "，连接MES网络服务器失败，正在尝试登录mes网服务器！")
							second_login();
						}
					}

				});
				return false;
			}

			//mes段网络登录调用方法
			function second_login() {

				//				alert('second_login被调用了')

				var unselectedMenu = localStorage.getItem('unselectedMenu');
				var username = document.getElementById("form-username").value;
				var password = document.getElementById("form-password").value;
				// var RemoteServiceIP1 = localStorage.getItem('RemoteServiceIP');
				// 				if(RemoteServiceIP1 != null && RemoteServiceIP1 != 'undefined' && RemoteServiceIP1 != "") {
				// 					window.serviceIP = 'http://' + RemoteServiceIP1 + '/ilpsService';
				// 				}
				// 					alert('RemoteServiceIP1' + RemoteServiceIP1)
				// 				alert('window.serviceIP' + window.serviceIP)
				$.ajax({
					type: 'POST',
					url: 'http://192.168.80.228:19001/ilpsService/api/login',
					dataType: "json",
					data: {
						'username': username,
						"password": password
					},
					async: true, //设置为false时,timeout不生效
					timeout: 5000,
					success: function(result) {
						if(result.status == "1") {
							localStorage.clear();
							localStorage.setItem('RemoteServiceIP', '192.168.80.228:19001');
							localStorage.setItem('myDefaultIP', '192.168.80.228:19001');
							localStorage.setItem('unselectedMenu', unselectedMenu);
							// console.log(result)
							// var login_info = null;
							// 							login_info = login_info || {};
							// 							login_info.token = result.token || '';
							// 							login_info.username = result.message.split("###")[0].trim() || '';
							// 							login_info.userID = username || '';
							// 							login_info.roleID = result.message.split("###")[1].trim() || '';
							// 							login_info.password = password || '';
							//登陆成功后获取token
							var token = JSON.parse(result.token);
							token.username = result.message.split("###")[0].trim() || '';
							token.userID = username || '';
							token.roleID = result.message.split("###")[1].trim() || '';
							token.password = password || '';

							// 							login_info = {
							// 								'token':result.token,
							// 								'username':result.message.split("###")[0].trim(),
							// 								'userID':username,
							// 								'roleID':result.message.split("###")[1].trim(),
							// 								'password': password
							// 							};
							// localStorage.setItem('Global_UserLogin_Info',Global_UserLogin_Info);
							// alert(localStorage.getItem('$users'))

							// 							$.cookie('username', result.message.split("###")[0].trim());
							// 							$.cookie('userID', username);
							// 							$.cookie('roleID', result.message.split("###")[1].trim());
							// 							$.cookie('password', password);

							if(result.message.split("###")[2].trim() != "-1" && result.message.split("###")[2].trim() != "null" && result.message.split("###")[2].trim().length > 1) {
								// $.cookie('plantID', result.message.split("###")[2].trim());
								token.plantID = result.message.split("###")[2].trim();

								localStorage.setItem('plantID', result.message.split("###")[2].trim());
							}
							if(result.message.split("###")[3].trim() != "-1" && result.message.split("###")[3].trim() != "null" && result.message.split("###")[3].trim().length > 1) {
								// $.cookie('processID', result.message.split("###")[3].trim());
								token.processID = result.message.split("###")[3].trim();

								localStorage.setItem('processID', result.message.split("###")[3].trim());
							}
							if(result.message.split("###")[4].trim() != "-1" && result.message.split("###")[4].trim() != "null" && result.message.split("###")[4].trim().length > 1) {
								// $.cookie('lineID', result.message.split("###")[4].trim());
								token.lineID = result.message.split("###")[4].trim();

								localStorage.setItem('lineID', result.message.split("###")[4].trim());
							}
							if(result.message.split("###")[5].trim() != "-1" && result.message.split("###")[5].trim() != "null" && result.message.split("###")[5].trim().length > 1) {
								token.workingkLocation = result.message.split("###")[5].trim();

								localStorage.setItem('workingkLocation', result.message.split("###")[5].trim());
							}
							// alert(JSON.stringify(token));
							// 							var Global_UserLogin_Info = [];
							// 							Global_UserLogin_Info.push(login_info);
							//将全局token等信息放入变量$Global_UserLogin_Info
							localStorage.setItem('$Global_UserLogin_Info', JSON.stringify(token));
							localStorage.setItem("LocalUserName", username);
							localStorage.setItem("LocalUserPsw", password);

							localStorage.setItem('token', result.token);
							localStorage.setItem('username', result.message.split("###")[0].trim());
							localStorage.setItem('userID', username);
							localStorage.setItem('roleID', result.message.split("###")[1].trim());
							localStorage.setItem('password', password);
							// 							var aa = localStorage.getItem('$Global_UserLogin_Info');
							// 							alert(aa.token)
							// 							var users = JSON.parse(localStorage.getItem('$Global_UserLogin_Info'));
							// 							alert(users.token)
							//							if('iOS' == window.plus.os.name) {
							//								// alert('IOS')
							//								window.location.href = "app_productionIndex_ios.html";
							//								return;
							//							}
							if(result.message.split("###")[1].trim() == "24") {
								window.location.href = "app_productionIndex.html";
							} else {
								window.location.href = "app_productionIndex.html";
							}

						} else {
							var hintinfo = document.getElementById("hintinfo");
							hintinfo.innerHTML = '<font color="red">用户名或密码错误，请重新填写。</font>';
							//							hintinfo.innerText = "用户名或密码错误，请重新填写。";
						}
					},

					error: function(xhr, status, err) {
						//					 	alert('出现错误,请联系管理员!')
					},
					complete: function(XMLHttpRequest, status) { //当请求完成时调用函数

						if(status == 'timeout') { //status == 'timeout'意为超时,status的可能取值：success,notmodified,nocontent,error,timeout,abort,parsererror 
							//alert(status + "，连接服务器失败，请检查配置信息及网络连接！");
							ww_login();
						}
					}

				});
				return false;
			}

			//mes段网络登录调用方法
			function ww_login() {

				//				alert('second_login被调用了')

				var unselectedMenu = localStorage.getItem('unselectedMenu');
				var username = document.getElementById("form-username").value;
				var password = document.getElementById("form-password").value;
				// var RemoteServiceIP1 = localStorage.getItem('RemoteServiceIP');
				// 				if(RemoteServiceIP1 != null && RemoteServiceIP1 != 'undefined' && RemoteServiceIP1 != "") {
				// 					window.serviceIP = 'http://' + RemoteServiceIP1 + '/ilpsService';
				// 				}
				// 					alert('RemoteServiceIP1' + RemoteServiceIP1)
				// 				alert('window.serviceIP' + window.serviceIP)
				$.ajax({
					type: 'POST',
					url: 'http://117.158.49.108:19001/ilpsService/api/login',
					dataType: "json",
					data: {
						'username': username,
						"password": password
					},
					async: true, //设置为false时,timeout不生效
					timeout: 5000,
					success: function(result) {
						if(result.status == "1") {
							localStorage.clear();
							localStorage.setItem('RemoteServiceIP', '117.158.49.108:19001');
							localStorage.setItem('unselectedMenu', unselectedMenu);
							localStorage.setItem('myDefaultIP', '117.158.49.108:19001');
							// console.log(result)
							// var login_info = null;
							// 							login_info = login_info || {};
							// 							login_info.token = result.token || '';
							// 							login_info.username = result.message.split("###")[0].trim() || '';
							// 							login_info.userID = username || '';
							// 							login_info.roleID = result.message.split("###")[1].trim() || '';
							// 							login_info.password = password || '';
							//登陆成功后获取token
							var token = JSON.parse(result.token);
							token.username = result.message.split("###")[0].trim() || '';
							token.userID = username || '';
							token.roleID = result.message.split("###")[1].trim() || '';
							token.password = password || '';

							// 							login_info = {
							// 								'token':result.token,
							// 								'username':result.message.split("###")[0].trim(),
							// 								'userID':username,
							// 								'roleID':result.message.split("###")[1].trim(),
							// 								'password': password
							// 							};
							// localStorage.setItem('Global_UserLogin_Info',Global_UserLogin_Info);
							// alert(localStorage.getItem('$users'))

							// 							$.cookie('username', result.message.split("###")[0].trim());
							// 							$.cookie('userID', username);
							// 							$.cookie('roleID', result.message.split("###")[1].trim());
							// 							$.cookie('password', password);

							if(result.message.split("###")[2].trim() != "-1" && result.message.split("###")[2].trim() != "null" && result.message.split("###")[2].trim().length > 1) {
								// $.cookie('plantID', result.message.split("###")[2].trim());
								token.plantID = result.message.split("###")[2].trim();

								localStorage.setItem('plantID', result.message.split("###")[2].trim());
							}
							if(result.message.split("###")[3].trim() != "-1" && result.message.split("###")[3].trim() != "null" && result.message.split("###")[3].trim().length > 1) {
								// $.cookie('processID', result.message.split("###")[3].trim());
								token.processID = result.message.split("###")[3].trim();

								localStorage.setItem('processID', result.message.split("###")[3].trim());
							}
							if(result.message.split("###")[4].trim() != "-1" && result.message.split("###")[4].trim() != "null" && result.message.split("###")[4].trim().length > 1) {
								// $.cookie('lineID', result.message.split("###")[4].trim());
								token.lineID = result.message.split("###")[4].trim();

								localStorage.setItem('lineID', result.message.split("###")[4].trim());
							}
							if(result.message.split("###")[5].trim() != "-1" && result.message.split("###")[5].trim() != "null" && result.message.split("###")[5].trim().length > 1) {
								token.workingkLocation = result.message.split("###")[5].trim();

								localStorage.setItem('workingkLocation', result.message.split("###")[5].trim());
							}
							// alert(JSON.stringify(token));
							// 							var Global_UserLogin_Info = [];
							// 							Global_UserLogin_Info.push(login_info);
							//将全局token等信息放入变量$Global_UserLogin_Info
							localStorage.setItem('$Global_UserLogin_Info', JSON.stringify(token));
							localStorage.setItem("LocalUserName", username);
							localStorage.setItem("LocalUserPsw", password);

							localStorage.setItem('token', result.token);
							localStorage.setItem('username', result.message.split("###")[0].trim());
							localStorage.setItem('userID', username);
							localStorage.setItem('roleID', result.message.split("###")[1].trim());
							localStorage.setItem('password', password);
							// 							var aa = localStorage.getItem('$Global_UserLogin_Info');
							// 							alert(aa.token)
							// 							var users = JSON.parse(localStorage.getItem('$Global_UserLogin_Info'));
							// 							alert(users.token)
							//							if('iOS' == window.plus.os.name) {
							//								// alert('IOS')
							//								window.location.href = "app_productionIndex_ios.html";
							//								return;
							//							}
							if(result.message.split("###")[1].trim() == "24") {
								window.location.href = "app_productionIndex.html";
							} else {
								window.location.href = "app_productionIndex.html";
							}

						} else {
							var hintinfo = document.getElementById("hintinfo");
							hintinfo.innerHTML = '<font color="red">用户名或密码错误，请重新填写。</font>';
							//							hintinfo.innerText = "用户名或密码错误，请重新填写。";
						}
					},

					error: function(xhr, status, err) {
						//					 	alert('出现错误,请联系管理员!')
					},
					complete: function(XMLHttpRequest, status) { //当请求完成时调用函数

						if(status == 'timeout') { //status == 'timeout'意为超时,status的可能取值：success,notmodified,nocontent,error,timeout,abort,parsererror 
							alert(status + "，连接服务器失败，请检查配置信息及网络连接！")
						}
					}

				});
				return false;
			}
		</script>
	</body>

</html>